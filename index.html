<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Dragon Warrior</title>
<style>
  body {
    margin: 0; 
    background: #000;
    overflow: hidden;
    font-family: monospace;
    color: white;
  }
  canvas {
    background: #111;
    display: block;
    margin: auto;
    border: 2px solid #555;
  }
  #info {
    text-align: center;
    margin-top: 5px;
    font-weight: bold;
  }
  #startScreen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(#000, #333);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: white;
    font-family: monospace;
    z-index: 9999;
  }
  #startScreen h1 {
    font-size: 48px;
    margin-bottom: 20px;
  }
  #startScreen button {
    padding: 15px 30px;
    font-size: 20px;
    background: #228B22;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
  }
  #startScreen button:hover {
    background: #1e6e1e;
  }
  #gameOverScreen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.9);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: white;
    font-family: monospace;
    z-index: 9999;
    display: none;
  }
  #gameOverScreen h2 {
    font-size: 36px;
    margin-bottom: 20px;
  }
  #gameOverScreen button {
    padding: 12px 25px;
    font-size: 18px;
    background: #dc3545;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
  #gameOverScreen button:hover {
    background: #b02a37;
  }
</style>
</head>
<body>
<div id="startScreen">
  <h1>Dragon Warrior</h1>
  <p>Defeat the dragon across 5 levels!</p>
  <button onclick="startGame()">Start Game</button>
</div> 

<canvas id="gameCanvas" width="800" height="600"></canvas>

<div id="info">Use arrow keys to move. Press A to shoot. Press W to climb walls (levels 4+).</div>

<div id="gameOverScreen">
  <h2>Game Over</h2>
  <button onclick="restartGame()">Restart Game</button>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const castleColors = ['#8B7D7B', '#6B8E23', '#8B4513', '#2F4F4F', '#483D8B'];
const maxLevel = 5;
let currentLevel = 1;
let gameOver = false;

const keys = {};
document.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

// --- SPRITES (simple pixel art) ---

const colors = {
  'R': '#0033cc', // hero blue shirt
  'W': '#fffacd', // skin tone
  'G': '#228B22', // dragon green
  '.': null
};

const heroFrames = [
  [
    '.....RRR.....',
    '.....RRR.....',
    '....RWRWR....',
    '....RRRRR....',
    '...RWWWWWR...',
    '..RRR..RRR...',
    '.RWW....WWR..',
    'RRR......RRR.',
  ],
  [
    '.....RRR.....',
    '.....RRR.....',
    '....RWRWR....',
    '....RRRRR....',
    '...RWWWWWR...',
    '..RRR..RRR...',
    '.RWW....WWR..',
    'RRRR.....WRR.',
  ]
];

const dragonFrames = [
  [
    '...GGGGG....',
    '..GGGGGGG...',
    '..GGG.WGGG..',
    '.GGGGGGGGG..',
    '.GGGWWWGGG..',
    '..GGGGGGG...',
    '...GG.GG....',
    '....GG......'
  ],
  [
    '...GGGGG....',
    '..GGGGGGG...',
    '..GGG.WGGG..',
    '.GGGGGGGGG..',
    '.GGWWWGGGG..',
    '..GGGGGGG...',
    '...G.GG.....',
    '....GG......'
  ]
];

function drawSprite(x, y, scale, frame, spriteData) {
  const size = 4;
  for(let row=0; row < spriteData.length; row++) {
    for(let col=0; col < spriteData[row].length; col++) {
      const c = spriteData[row][col];
      if(colors[c]) {
        ctx.fillStyle = colors[c];
        ctx.fillRect(x + col * size * scale, y + row * size * scale, size * scale, size * scale);
      }
    }
  }
}

// Entities
const hero = {
  x: 100, y: 500, width: 48, height: 32,
  health: 100, maxHealth: 100,
  frameIndex: 0, frameTimer: 0,
  scale: 1.5,
  speed: 5,
  bulletCooldown: 0
};

const dragon = {
  x: 600, y: 400, width: 52, height: 32,
  health: 200, maxHealth: 200,
  scale: 2.5,
  frameIndex: 0,
  frameTimer: 0,
  wingOffsetY: 0,
  wingDirection: 1,
  bulletCooldown: 0
};

const walls = [
  { x: 300, y: 400, width: 40, height: 120 },
  { x: 500, y: 300, width: 40, height: 180 }
];

let lifelinePlants = [];
let heroBullets = [];
let dragonFireballs = [];

function drawHealthBar(x, y, health, maxHealth, color) {
  ctx.fillStyle = '#555';
  ctx.fillRect(x, y, 60, 8);
  ctx.fillStyle = color;
  ctx.fillRect(x, y, 60 * (health / maxHealth), 8);
  ctx.strokeStyle = 'black';
  ctx.strokeRect(x, y, 60, 8);
}

function drawBackground() {
  ctx.fillStyle = castleColors[currentLevel - 1];
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // Draw castle (simple block on right side)
  ctx.fillStyle = '#444';
  ctx.fillRect(canvas.width - 250, canvas.height - 300, 200, 300);
}

function drawWalls() {
  if(currentLevel >= 4) {
    ctx.fillStyle = 'brown';
    walls.forEach(wall => ctx.fillRect(wall.x, wall.y, wall.width, wall.height));
  }
}

function spawnLifeline() {
  if(Math.random() < 0.01 && lifelinePlants.length < 3) {
    const x = Math.random() * (canvas.width - 20);
    lifelinePlants.push({ x, y: 0, width: 20, height: 20, speed: 2 });
  }
}

function updateLifelines() {
  lifelinePlants.forEach(p => p.y += p.speed);
  lifelinePlants = lifelinePlants.filter(p => {
    // collision with hero
    if(p.x < hero.x + hero.width &&
       p.x + p.width > hero.x &&
       p.y < hero.y + hero.height &&
       p.y + p.height > hero.y) {
      hero.health = Math.min(hero.maxHealth, hero.health + 20);
      return false; // remove
    }
    return p.y < canvas.height;
  });
}

function drawLifelines() {
  ctx.fillStyle = 'limegreen';
  lifelinePlants.forEach(p => {
    ctx.beginPath();
    ctx.ellipse(p.x + p.width/2, p.y + p.height/2, p.width/2, p.height/2, 0, 0, 2 * Math.PI);
    ctx.fill();
  });
}

function checkWallClimb() {
  if(currentLevel >= 4) {
    walls.forEach(wall => {
      if(hero.x + hero.width > wall.x &&
         hero.x < wall.x + wall.width &&
         hero.y + hero.height >= wall.y &&
         hero.y + hero.height <= wall.y + 10 &&
         keys['w']) {
        hero.y -= hero.speed;
      }
    });
  }
}

function updateHero() {
  if(keys['arrowleft'] || keys['a']) {
    hero.x -= hero.speed;
    if(hero.x < 0) hero.x = 0;
  }
  if(keys['arrowright'] || keys['d']) {
    hero.x += hero.speed;
    if(hero.x + hero.width > canvas.width) hero.x = canvas.width - hero.width;
  }
  if(keys['arrowup'] || keys['w']) {
    // Climbing walls possible from level 4 onwards
    if(currentLevel < 4) {
      hero.y -= hero.speed;
      if(hero.y < 0) hero.y = 0;
    } else {
      checkWallClimb();
    }
  }
  if(keys['arrowdown'] || keys['s']) {
    hero.y += hero.speed;
    if(hero.y + hero.height > canvas.height) hero.y = canvas.height - hero.height;
  }

  // Shoot bullet
  if(keys['a'] && hero.bulletCooldown <= 0) {
    heroBullets.push({x: hero.x + hero.width, y: hero.y + hero.height / 2, width: 10, height: 4, speed: 10});
    hero.bulletCooldown = 15;
  }
  if(hero.bulletCooldown > 0) hero.bulletCooldown--;

  // Animate hero sprite
  hero.frameTimer++;
  if(hero.frameTimer > 10) {
    hero.frameIndex = (hero.frameIndex + 1) % heroFrames.length;
    hero.frameTimer = 0;
  }
}

function updateDragon() {
  // Simple AI: move up and down slowly
  dragon.y += dragon.wingDirection * 1;
  if(dragon.y < 300 || dragon.y > 450) dragon.wingDirection *= -1;

  // Animate dragon wings
  dragon.frameTimer++;
  if(dragon.frameTimer > 12) {
    dragon.frameIndex = (dragon.frameIndex + 1) % dragonFrames.length;
    dragon.frameTimer = 0;
  }

  // Dragon shoots fireballs every 90 frames
  if(dragon.bulletCooldown <= 0) {
    dragonFireballs.push({x: dragon.x, y: dragon.y + dragon.height/2, width: 16, height: 8, speed: -8});
    dragon.bulletCooldown = 90 - (currentLevel * 10); // faster at higher levels
  } else {
    dragon.bulletCooldown--;
  }
}

function updateBullets() {
  // Hero bullets move right
  heroBullets.forEach(b => b.x += b.speed);
  heroBullets = heroBullets.filter(b => b.x < canvas.width);

  // Dragon fireballs move left
  dragonFireballs.forEach(f => f.x += f.speed);
  dragonFireballs = dragonFireballs.filter(f => f.x + f.width > 0);
}

function checkCollisions() {
  // Hero bullets hit dragon
  heroBullets.forEach((b,i) => {
    if(b.x < dragon.x + dragon.width &&
       b.x + b.width > dragon.x &&
       b.y < dragon.y + dragon.height &&
       b.y + b.height > dragon.y) {
      dragon.health -= 15;
      heroBullets.splice(i, 1);
      if(dragon.health <= 0) {
        currentLevel++;
        if(currentLevel > maxLevel) {
          endGame(true);
        } else {
          nextLevel();
        }
      }
    }
  });

  // Dragon fireballs hit hero
  dragonFireballs.forEach((f,i) => {
    if(f.x < hero.x + hero.width &&
       f.x + f.width > hero.x &&
       f.y < hero.y + hero.height &&
       f.y + f.height > hero.y) {
      hero.health -= 10;
      dragonFireballs.splice(i, 1);
      if(hero.health <= 0) {
        endGame(false);
      }
    }
  });
}

function nextLevel() {
  // Reset positions and health
  hero.x = 100; hero.y = 500; hero.health = 100;
  dragon.x = 600; dragon.y = 400; dragon.health = 200 + (currentLevel - 1) * 50;
  heroBullets = [];
  dragonFireballs = [];
  lifelinePlants = [];
}

function endGame(won) {
  gameOver = true;
  document.getElementById('gameOverScreen').style.display = 'flex';
  document.getElementById('gameOverScreen').querySelector('h2').textContent = won ? 'You Win! Congratulations!' : 'Game Over - You Lost!';
}

function restartGame() {
  currentLevel = 1;
  nextLevel();
  gameOver = false;
  document.getElementById('gameOverScreen').style.display = 'none';
  document.getElementById('startScreen').style.display = 'flex';
}

function drawHero() {
  drawSprite(hero.x, hero.y, hero.scale, hero.frameIndex, heroFrames[hero.frameIndex]);
}

function drawDragon() {
  drawSprite(dragon.x, dragon.y, dragon.scale, dragon.frameIndex, dragonFrames[dragon.frameIndex]);
}

function drawBullets() {
  ctx.fillStyle = 'yellow';
  heroBullets.forEach(b => ctx.fillRect(b.x, b.y, b.width, b.height));
  ctx.fillStyle = 'orange';
  dragonFireballs.forEach(f => ctx.fillRect(f.x, f.y, f.width, f.height));
}

function drawInfo() {
  ctx.fillStyle = 'white';
  ctx.font = '16px monospace';
  ctx.fillText(`Level: ${currentLevel}`, 10, 20);
  ctx.fillText(`Hero HP: ${hero.health}`, 10, 40);
  ctx.fillText(`Dragon HP: ${dragon.health}`, canvas.width - 150, 20);
}

function gameLoop() {
  if(gameOver) return;

  drawBackground();
  drawWalls();
  spawnLifeline();
  updateLifelines();
  drawLifelines();

  updateHero();
  updateDragon();
  updateBullets();
  checkCollisions();

  drawHero();
  drawDragon();
  drawBullets();
  drawHealthBar(10, 45, hero.health, hero.maxHealth, 'lime');
  drawHealthBar(canvas.width - 150, 45, dragon.health, dragon.maxHealth, 'red');
  drawInfo();

  requestAnimationFrame(gameLoop);
}

function startGame() {
  document.getElementById('startScreen').style.display = 'none';
  nextLevel();
  gameOver = false;
  gameLoop();
}
</script>
</body>
</html>
